
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1">




<link
  href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"
  rel="stylesheet">

<style>
.julia {font-family: "Source Code Pro";
        color:#0033CC;
        }
body { padding-top: 60px; }
h5:before {content:"\2746\ ";}
h6:before {content:"\2742\ ";}
pre {display: block;}
</style>

<script src="http://code.jquery.com/jquery.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

<!-- .julia:before {content: "julia> "} -->

<style></style>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>


<!-- not TeX-AMS-MML_HTMLorMML-->
<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_SVG">  
</script>
<script>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ["\$","\$"], ["\\(","\\)"]]
  },
  displayAlign: "left",
  displayIndent: "5%"
});
</script>


<script type="text/javascript">
$( document ).ready(function() {
  $("h1").each(function(index) { 
       var title = $( this ).text()
       $("#page_title").html("<strong>" + title + "</strong>");
       document.title = title
  });
  $( "h2" ).each(function( index ) {
    var nm =  $( this ).text();                                    
    var id = $.trim(nm).replace(/ /g,'');
    this.id = id
    $("#page_dropdown").append("<li><a href='#" + id + "'>" + nm + "</a></li>");
  });
  $('[data-toggle="popover"]').popover();  
});
</script>

</head>


<body data-spy="scroll" >

<nav class="navbar navbar-default  navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
         
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="#" id="page_title"></a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
         <li class="dropdown">
           <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
           Jump to... <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="page_dropdown"></ul>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<header>
</header>

<div class="container-fluid">
  <div class="span10 offset1">
<h1>Runge Kutta</h1><p>The <a href="https://github.com/JuliaLang/ODE.jl/blob/master/src/runge_kutta.jl">Runge-Kutta</a> methods are formalization the Taylor Series method.</p><p>Again solving an IVP:</p>$$~
x'(t) = f(t,x), \quad x(t_0) = x_0.
~$$
<p>We expand $x(t+h) = x(t) + x'(t) h + x''(t) h^2/2 + \cdots$. To do so we need derivatives. Let $\phi(t) = [t,x(t)]$ be a vector-valued function and $\nabla f = [f_t, f_x]$ be the partial derivatives:</p>$$~
\begin{align}
x'(t) &= f(t, x)\\
x''(t)&= \nabla f(\phi(t)) \cdot \phi'(t) = [f_t(\phi), f_x(\phi)] \cdot [1, x'] = f_t + x' \cdot f_x = f_t(\phi) + f(\phi) \cdot f_x(\phi)\\
x'''(t)&= \nabla (f_t + f \cdot f_x)(\phi)  = \nabla (G(\phi)) = [G_t, G_x] \cdot [1, x'] =
[f_{tt} + f_t f_x + ff_{tx}, f_{tx} + f_x f_x + f f_{xx}](\phi) \cdot [1, x']
= (f_{tt} + f_t f_x + ff_{tx} + f_{tx} f + (f_x)^2 f + f^2 f_{xx})(\phi)\\
x''''(t) &= \dots
\end{align}
~$$
<p>Now, we use the taylor expansion for a function of two variables:</p>$$~
f(t+h, x+hf) = f(t, x) + f_t(t,x) h + f_x(t,x)hf + \mathcal{O}(h^2)
$$

The choice of $hf$ is there so that we can substitute in for $f f_x$:

$$~
x(t+h) = x + f (h/2) + f(t+h, x + hf) h/2 +  \mathcal{O}(h^2)
~$$
<p>This gives the formula to move a step:</p>$$~
x(t+h) = x(t) + \frac{1}{2} F_1+ \frac{1}{2} F_2,
~$$
<p>With</p>$$~
F_1 = hf, \quad F_2 = hf(t+h, x + F_1)
~$$
<p>The book calls this Heun's method (1859-1929).</p><p>It is used like Euler's method:</p><h3>General RK method</h3><p>The general second-order method may have coefficients:</p>$$~
x(t+h) = x + w_1 hf + w_2 hf(t +\alpha h, x + \beta h f) + \mathcal{O}(h^3)
= x + w_1 hf + w_2 h \left( f + \alpha hf_t + \beta h f f_x\right) + \mathcal{O}(h^3)
~$$
<p>The coefficients satisfy: $w1 + w2=1, w_2\alpha = 1/2, w_2\beta = 1/2$.</p><p>Setting $w_1 = 0, w_2 = 1, \alpha = \beta = 1/2$ gives:</p>$$~
\begin{align}
x(t+h) &= x(t) + F2\\
F_1 &= h f(t,x)\\
F_2 &= h f(t + h/2, x + F1/2).
\end{align}
~$$
<p>This is called a modified Euler method, which is of the form $x(t+h) = x(t) + F1$</p><h3>Example</h3><p>Apply both Euler and the modifed Euler to the IVP</p>$$~
x'(t) = \pi e^{-t} \cdot \cos(\pi t) - x, \quad x(0) = 0.
~$$
<pre class="sourceCode julia">f(t, x) = pi * exp(-t) * cos(pi*t) - x
h = 1/25
F1(t, x) = h * f(t,x)
F2(t, x) = h * f(t + h/2, x + F1(t,x)/2)
ts = [0.0]
es = [0.0]
mes = [0.0]
for i in 1:25
t,ex,mx = ts[end], es[end], mes[end]
push!(ts, t + h)
push!(es, ex + F1(t, ex))
push!(mes, mx + F2(t, mx))
end</pre>
<p>To visualize, we have:</p><pre class="sourceCode julia">using Plots
plot(ts, es, color=:blue)
plot!(ts, mes, color=:red)
plot!(t -> exp(-t) *sin(pi*t), 0, 1, color=:green)</pre>
    <div id="5cee3b93-1001-427c-9545-c4a35adbfc42" style="width:600px;height:400px;"></div>
    <script>
    PLOT = document.getElementById('5cee3b93-1001-427c-9545-c4a35adbfc42');
    Plotly.plot(PLOT, [{"showlegend":true,"mode":"lines","xaxis":"x","colorbar":{"title":""},"line":{"color":"rgba(0, 0, 255, 1.000)","shape":"linear","dash":"solid","width":1},"y":[0.0,0.12566370614359174,0.24042147737076958,0.34316241646966783,0.4330629578271883,0.5095784668002298,0.5724308318693816,0.621592564660402,0.6572679416032643,0.6798717293378912,0.6900060346261109,0.6884358092583016,0.6760635221079913,0.6539034850143562,0.6230562875350711,0.5846837588122475,0.5399848338433347,0.4901726573494575,0.4364532121638139,0.38000571156155727,0.3219649471074925,0.2634057362338958,0.20532956763132115,0.1486534983153619,0.09420131451319377,0.04269692979935624],"type":"scatter","name":"y1","yaxis":"y","x":[0.0,0.04,0.08,0.12,0.16,0.2,0.24000000000000002,0.28,0.32,0.36,0.39999999999999997,0.43999999999999995,0.4799999999999999,0.5199999999999999,0.5599999999999999,0.6,0.64,0.68,0.7200000000000001,0.7600000000000001,0.8000000000000002,0.8400000000000002,0.8800000000000002,0.9200000000000003,0.9600000000000003,1.0000000000000002]},{"showlegend":true,"mode":"lines","xaxis":"x","colorbar":{"title":""},"line":{"color":"rgba(255, 0, 0, 1.000)","shape":"linear","dash":"solid","width":1},"y":[0.0,0.12041906541058868,0.22955234693897986,0.3264468326338789,0.4104270160066179,0.4810848354625289,0.5382659236108631,0.5820526796596955,0.6127446916667351,0.6308370391469134,0.6369970011269114,0.6320396809784754,0.6169030381278844,0.5926227889574577,0.5603076058535499,0.5211150053998747,0.4762282751519074,0.4268347442285795,0.37410565706186044,0.31917786294952094,0.2631374874021864,0.20700570543821575,0.15172669266119881,0.09815778777785428,0.04706186071808538,-0.0008981558430364162],"type":"scatter","name":"y2","yaxis":"y","x":[0.0,0.04,0.08,0.12,0.16,0.2,0.24000000000000002,0.28,0.32,0.36,0.39999999999999997,0.43999999999999995,0.4799999999999999,0.5199999999999999,0.5599999999999999,0.6,0.64,0.68,0.7200000000000001,0.7600000000000001,0.8000000000000002,0.8400000000000002,0.8800000000000002,0.9200000000000003,0.9600000000000003,1.0000000000000002]},{"showlegend":true,"mode":"lines","xaxis":"x","colorbar":{"title":""},"line":{"color":"rgba(0, 128, 0, 1.000)","shape":"linear","dash":"solid","width":1},"y":[0.007651278046605034,0.015264792141697339,0.022840234155674082,0.030377299920516042,0.09819854985388946,0.16249418252264042,0.22307176175167143,0.27976747491825626,0.3425847985692515,0.3994175226490569,0.442704874408673,0.4815769882485019,0.518778132050407,0.5507565952745629,0.5756480152073291,0.5961953696032717,0.6134904337112251,0.626008895887307,0.6347372398111556,0.6375242262609842,0.6352611208400579,0.6287822968034651,0.6198306676553851,0.6080109504054302,0.5920756917776473,0.5732036406788706,0.5515158800912755,0.5273819615536901,0.46667115549206184,0.40167547346955307,0.32929154134926136,0.26646444886976256,0.1896510149885912,0.11934111613219753,0.014872210703299965],"type":"scatter","name":"y3","yaxis":"y","x":[0.002441454754947033,0.004882909509894066,0.007324364264841099,0.009765819019788131,0.032340593556934305,0.054915368094080486,0.07749014263122667,0.10006491716837283,0.12719791423699836,0.15433091130562387,0.17727151501069482,0.20021211871576575,0.2251320443744086,0.2500519700330514,0.2730259372838398,0.29599990453462816,0.320630425470559,0.3452609464064898,0.3737978203725111,0.4023346943385323,0.42769490022477685,0.45305510611102146,0.47529372132562075,0.49753233654022,0.5217783965977698,0.5460244566553195,0.5704146177040659,0.5948047787528121,0.6487376626244042,0.7000534407448434,0.7534099435113505,0.7983247536668452,0.8531606459863641,0.9047080021287085,0.9872908640160599]}], {"showlegend":true,"xaxis":{"tickvals":[0.0,0.2,0.4,0.6000000000000001,0.8,1.0],"ticks":"inside","tickmode":"array","domain":[0.0658209390492855,0.9934383202099738],"linecolor":"rgba(0, 0, 0, 1.000)","showgrid":true,"title":"","tickangle":0,"titlefont":{"color":"rgba(0, 0, 0, 1.000)","family":"sans-serif","size":15},"tickcolor":"rgba(0, 0, 0, 1.000)","ticktext":["0.0","0.2","0.4","0.6","0.8","1.0"],"zeroline":false,"type":"-","tickfont":{"color":"rgba(0, 0, 0, 1.000)","family":"sans-serif","size":11},"anchor":"y"},"paper_bgcolor":"rgba(255, 255, 255, 1.000)","annotations":[],"height":400,"margin":{"l":0,"b":20,"r":0,"t":20},"plot_bgcolor":"rgba(255, 255, 255, 1.000)","yaxis":{"tickvals":[0.0,0.25,0.5],"ticks":"inside","tickmode":"array","domain":[0.03762029746281716,0.9901574803149606],"linecolor":"rgba(0, 0, 0, 1.000)","showgrid":true,"title":"","tickangle":0,"titlefont":{"color":"rgba(0, 0, 0, 1.000)","family":"sans-serif","size":15},"tickcolor":"rgba(0, 0, 0, 1.000)","ticktext":["0.00","0.25","0.50"],"zeroline":false,"type":"-","tickfont":{"color":"rgba(0, 0, 0, 1.000)","family":"sans-serif","size":11},"anchor":"x"},"legend":{"bordercolor":"rgba(0, 0, 0, 1.000)","bgcolor":"rgba(255, 255, 255, 1.000)","font":{"color":"rgba(0, 0, 0, 1.000)","family":"sans-serif","size":11},"y":1.0,"x":1.0},"width":600});
    </script>
<p>As can be seen the modified Euler has a smaller error.</p><h2>Higher order RK methods</h2><p>This process can be repeated. Here is an answer for the classical RK method of order 4 (error $\approx \mathcal{O}(h^5)$):</p>$$~
x(t+h) = x(t) + \frac{1}{6}F_1 + \frac{1}{3} F_2 + \frac{1}{3}F_3 + \frac{1}{6}F_4
~$$
<p>where</p>$$~
\begin{align}
F1(t,x) &= h f(t,x)\\
F2(t,x) &= hf(t + h/2, x + F_1/2)\\
F3(t,x) &=  hf(t + h/2, x + F_2/2)\\
F4(t,x) &=  hf(t + h, x + F_3).
\end{align}
~$$
<p>We can    visualize and compare:</p><pre class="sourceCode julia">F3(t,x) = h*f(t + h/2, x + F2(t,x)/2)
F4(t,x) = h*f(t + h, x + F3(t,x))
ts = [0.0]
m4es = [0.0]

for i in 1:25
t,x= ts[end], m4es[end]
push!(ts, t + h)
push!(m4es,  x + F1(t,x)/6 + F2(t,x)/3 + F3(t,x)/3 + F4(t,x)/6 )
end</pre>
<p>We compare to the exact answer</p><pre class="sourceCode julia">plot(ts, m4es, color=:black)
plot!(t -> exp(-t) *sin(pi*t), 0, 1, color=:green)</pre>
    <div id="721c46e1-4767-4deb-89db-9d94aec72733" style="width:600px;height:400px;"></div>
    <script>
    PLOT = document.getElementById('721c46e1-4767-4deb-89db-9d94aec72733');
    Plotly.plot(PLOT, [{"showlegend":true,"mode":"lines","xaxis":"x","colorbar":{"title":""},"line":{"color":"rgba(0, 0, 0, 1.000)","shape":"linear","dash":"solid","width":1},"y":[0.0,0.1204188524265297,0.22956970925760295,0.3264972010674788,0.4105234149123627,0.48123787662028744,0.538483839808554,0.5823413944130803,0.613107921170637,0.6312764223154695,0.6375122534286944,0.6326287677039377,0.617562362736324,0.5933473922323961,0.5610913717421578,0.5219508696164307,0.47710843287937926,0.42775085354821707,0.3750490350700343,0.32013967187585457,0.2641089084154357,0.20797809820876811,0.15269173913435416,0.09910761899354807,0.04798916588434926,-3.845925608796791e-8],"type":"scatter","name":"y1","yaxis":"y","x":[0.0,0.04,0.08,0.12,0.16,0.2,0.24000000000000002,0.28,0.32,0.36,0.39999999999999997,0.43999999999999995,0.4799999999999999,0.5199999999999999,0.5599999999999999,0.6,0.64,0.68,0.7200000000000001,0.7600000000000001,0.8000000000000002,0.8400000000000002,0.8800000000000002,0.9200000000000003,0.9600000000000003,1.0000000000000002]},{"showlegend":true,"mode":"lines","xaxis":"x","colorbar":{"title":""},"line":{"color":"rgba(0, 128, 0, 1.000)","shape":"linear","dash":"solid","width":1},"y":[0.007651278046605034,0.015264792141697339,0.022840234155674082,0.030377299920516042,0.09819854985388946,0.16249418252264042,0.22307176175167143,0.27976747491825626,0.3425847985692515,0.3994175226490569,0.442704874408673,0.4815769882485019,0.518778132050407,0.5507565952745629,0.5756480152073291,0.5961953696032717,0.6134904337112251,0.626008895887307,0.6347372398111556,0.6375242262609842,0.6352611208400579,0.6287822968034651,0.6198306676553851,0.6080109504054302,0.5920756917776473,0.5732036406788706,0.5515158800912755,0.5273819615536901,0.46667115549206184,0.40167547346955307,0.32929154134926136,0.26646444886976256,0.1896510149885912,0.11934111613219753,0.014872210703299965],"type":"scatter","name":"y2","yaxis":"y","x":[0.002441454754947033,0.004882909509894066,0.007324364264841099,0.009765819019788131,0.032340593556934305,0.054915368094080486,0.07749014263122667,0.10006491716837283,0.12719791423699836,0.15433091130562387,0.17727151501069482,0.20021211871576575,0.2251320443744086,0.2500519700330514,0.2730259372838398,0.29599990453462816,0.320630425470559,0.3452609464064898,0.3737978203725111,0.4023346943385323,0.42769490022477685,0.45305510611102146,0.47529372132562075,0.49753233654022,0.5217783965977698,0.5460244566553195,0.5704146177040659,0.5948047787528121,0.6487376626244042,0.7000534407448434,0.7534099435113505,0.7983247536668452,0.8531606459863641,0.9047080021287085,0.9872908640160599]}], {"showlegend":true,"xaxis":{"tickvals":[0.0,0.2,0.4,0.6000000000000001,0.8,1.0],"ticks":"inside","tickmode":"array","domain":[0.0658209390492855,0.9934383202099738],"linecolor":"rgba(0, 0, 0, 1.000)","showgrid":true,"title":"","tickangle":0,"titlefont":{"color":"rgba(0, 0, 0, 1.000)","family":"sans-serif","size":15},"tickcolor":"rgba(0, 0, 0, 1.000)","ticktext":["0.0","0.2","0.4","0.6","0.8","1.0"],"zeroline":false,"type":"-","tickfont":{"color":"rgba(0, 0, 0, 1.000)","family":"sans-serif","size":11},"anchor":"y"},"paper_bgcolor":"rgba(255, 255, 255, 1.000)","annotations":[],"height":400,"margin":{"l":0,"b":20,"r":0,"t":20},"plot_bgcolor":"rgba(255, 255, 255, 1.000)","yaxis":{"tickvals":[0.0,0.25,0.5],"ticks":"inside","tickmode":"array","domain":[0.03762029746281716,0.9901574803149606],"linecolor":"rgba(0, 0, 0, 1.000)","showgrid":true,"title":"","tickangle":0,"titlefont":{"color":"rgba(0, 0, 0, 1.000)","family":"sans-serif","size":15},"tickcolor":"rgba(0, 0, 0, 1.000)","ticktext":["0.00","0.25","0.50"],"zeroline":false,"type":"-","tickfont":{"color":"rgba(0, 0, 0, 1.000)","family":"sans-serif","size":11},"anchor":"x"},"legend":{"bordercolor":"rgba(0, 0, 0, 1.000)","bgcolor":"rgba(255, 255, 255, 1.000)","font":{"color":"rgba(0, 0, 0, 1.000)","family":"sans-serif","size":11},"y":1.0,"x":1.0},"width":600});
    </script>
<h2>General form</h2><p>This is from <a href="http://tinyurl.com/pzm7tww">Wikipedia</a></p><p>The general form of an RK method becomes:</p>$$~
x_{n+1} = x_n + h \sum_{i=1}^s b_i k_i
k_i = f(t_n + c_i h, x_n + h \sum_{j=1}^s a_{ij} k_j
~$$
<p>Where, the coefficients $a,b,c$ are from a table:</p>$$~
\begin{array}{c|cccc}
c_1 & a_{11} & a_{12} & \cdots & a_{1s}\\
c_2 & a_{21} & a_{22} & \cdots & a_{2s}\\
&&\cdots&&\\
c_s & a_{s1} & a_{s2} & \cdots & a_{ss}\\
\hline
& b_1 & b_2 & \cdots & b_n
\end{array}
~$$
<p>To see some examples: <a href="https://github.com/JuliaLang/ODE.jl/blob/master/src/runge_kutta.jl">Runge-Kutta</a> .</p><h2>Error</h2><p>The local truncation error for the 4th order RK method is like $C h^5$, as the Taylor series used employs exact terms up to $h^4$.</p><p>If we have, as in the book, $x$ be the approximate solution and $x^*$ the exact one, we have:</p>$$~
x^*(t_0 + h) - x(t_0+h) = \text{local truncation error} = C h^5.
~$$
<p>How to monitor the growth of this error? The book suggests looking at $u$ – the approximate value with one step of size $h$ and $v$ – the approximate error of two steps of size $h/2$.</p><p>Then we have $x^*(t+h) = u + Ch^5$ and if $C$ is constant:</p>$$~
\begin{align}
x(t + h/2) &= v + C(h/2)^5\\
x(t + h) &= x(t + h/2 + h/2) = x(t+h/2) + C(h/2)^5 = v + C(h/2)^5 + C(h/2)^5 = v + 2C (h/2)^5
\end{align}
~$$
<p>So, we have local error $= Ch^5 = (u-v)/(1 = 2^{-4}$ so is basically estimated by $u-v$. This can be monitored during the evaluation to see if there is growth. If so, $h$ can be adjusted.</p>
  </div>
</div>  

</body>
</html>
